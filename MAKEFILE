# Compilateur
CXX = emcc

# Options de compilation
# -I./src : Pour trouver les headers (.hpp)
# -O3 : Optimisation pour la vitesse (conseillé pour le web)
CXXFLAGS = -std=c++17 -I./src -O3

# Options spécifiques à Emscripten
# -lembind : Active le binding C++ <-> JS
# -s ALLOW_MEMORY_GROWTH=1 : Évite les plantages si la grille est grande
# -s WASM=1 : Force la génération de WebAssembly
EMFLAGS = -lembind -s WASM=1 -s ALLOW_MEMORY_GROWTH=1

# Liste des fichiers sources (.cpp)
# J'ai inclus api.cpp qui est ton "pont" vers le JS
SRCS = src/grid.cpp src/agent.cpp src/dijkstra.cpp src/astar.cpp src/api.cpp

# Fichier de sortie (placé dans front/ pour être avec index.html)
OUTPUT = front/pathfinding.js

# --- RÈGLES ---

# Règle "build" : compile tout
build:
	$(CXX) $(CXXFLAGS) $(EMFLAGS) $(SRCS) -o $(OUTPUT)
	@echo "Compilation terminee ! Fichiers generes dans front/"

# Règle "clean" : supprime les fichiers générés
clean:
	rm -f front/pathfinding.js front/pathfinding.wasm
	@echo "Nettoyage termine."